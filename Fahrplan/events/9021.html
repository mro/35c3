<!DOCTYPE html>
<html>
<head>
<meta content="text/html; charset=utf-8" http-equiv="content-type">
<title>Schedule 34th Chaos Communication Congress</title>
<link rel="stylesheet" media="screen" href="/congress/2017/Fahrplan/public_schedule.css">
<link rel="stylesheet" media="all" href="/congress/2017/Fahrplan/style.css">
<link rel="stylesheet" media="print" href="/congress/2017/Fahrplan/public_schedule_print.css">
</head>
<body>
<div id="wrapper">
<div id="banner"></div>
<div id="header">
<h1>Schedule 34th Chaos Communication Congress</h1>
</div>
<div id="navigation">
<ul>
<li>
<a href="/congress/2017/Fahrplan/index.html">Overview</a>
</li>
<li>
<a href="/congress/2017/Fahrplan/schedule/1.html">
Wednesday
 - 
<span class="small-font">2017-12-27</span>
</a>
</li>
<li>
<a href="/congress/2017/Fahrplan/schedule/2.html">
Thursday
 - 
<span class="small-font">2017-12-28</span>
</a>
</li>
<li>
<a href="/congress/2017/Fahrplan/schedule/3.html">
Friday
 - 
<span class="small-font">2017-12-29</span>
</a>
</li>
<li>
<a href="/congress/2017/Fahrplan/schedule/4.html">
Saturday
 - 
<span class="small-font">2017-12-30</span>
</a>
</li>
<li>
<a href="/congress/2017/Fahrplan/speakers.html">Speakers</a>
</li>
<li>
<a href="/congress/2017/Fahrplan/events.html">Events</a>
</li>
<li>
<a href="/congress/2017/Fahrplan/timeline.html"><span class="translation_missing" title="translation missing: en.layouts.public_schedule.timeline">Timeline</span></a>
</li>
<li>
<a href="/congress/2017/Fahrplan/booklet.html"><span class="translation_missing" title="translation missing: en.layouts.public_schedule.booklet">Booklet</span></a>
</li>
<li>
<a href="/congress/2017/Fahrplan/qrcode.html">QR-Code</a>
</li>
</ul>

</div>
<div id="main-content">
<p class="release">Version bcc</p>
<h2>lecture: Squeezing a key through a carry bit</h2>
<h3 class="title">No bug is small enough</h3>
<div class="column left" id="basic">
<div class="image large"><img src="/congress/2017/Fahrplan/system/events/logos/000/009/021/large/download.jpeg" alt="Download"></div>
<p class="abstract">The Go implementation of the P-256 elliptic curve had a small bug due to a misplaced carry bit affecting less than 0.00000003% of field subtraction operations. We show how to build a full practical key recovery attack on top of it, capable of targeting JSON Web Encryption.</p>
<p class="description"></p>
<p>Carry bugs are fairly common, and usually too small to have big impact, or so they are considered. This one was no exception.</p>

<p class="description"></p>
<p><a href="https://github.com/golang/go/issues/20040">Go issue #20040</a> affected the optimized x86_64 assembly implementation of scalar multiplication on the NIST P-256 elliptic curve in the standard library.</p>

<p class="description"></p>
<p><code>p256SubInternal</code> computes <code>x - y mod p</code>. In order to be constant time it has to do both the math for <code>x &gt;= y</code> and for <code>x &lt; y</code>, it then chooses the result based on the carry bit of <code>x - y</code>. The old code chose wrong (<code>CMOVQNE</code> vs <code>CMOVQEQ</code>), but most of the times compensated by adding a carry bit that didn't belong in there (<code>ADCQ</code> vs <code>ANDQ</code>). Except when it didn't, once in a billion times (when <code>x - y &lt; 2^256 - p</code>). <a href="https://github.com/golang/go/commit/9294fa2749ffee7edbbb817a0ef9fe633136fa9c">The whole patch is 5 lines.</a></p>

<p class="description"></p>
<p>The bug was found by a Cloudflare engineer because it caused ECDSA verifications to fail erroneously but the security impact was initially unclear. We devised an adaptive bug attack that can recover a scalar input to <code>ScalarMult</code> by submitting attacker-controlled points and checking if the result is correct. Elliptic Curve Diffie-Hellman involves a secret scalar, a peer-provided point, and fails to establish a key if the result is incorrect.</p>

<p class="description"></p>
<p>We reported this to the Go team, Go 1.7.6 and 1.8.2 were issued and the vulnerability was assigned <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-8932">CVE-2017-8932</a>.</p>

<p class="description"></p>
<p>At a high level, this P-256 ScalarMult implementation processes the scalar in blocks of 5 bits. We can precompute points that trigger the bug for each (and only) 5 bit value, and submit them. When the protocol fails, we learned 5 key bits, and we move on to the next 5, Hollywood style. In about 500 submissions on average we recover the whole key.</p>

<p class="description"></p>
<p>The precomputation involves a lot of unusable points and edge cases, but by modifying the optimized assembly implementation and generating points intelligently, we can produce a full round of points in seconds on 1000 machines (or spot instances). Each round depends on the previous ones, so must be computed live during each attack.</p>

<p class="description"></p>
<p>Normal ECDH does not offer an attacker multiple attempts against the same scalar, making the attack impossible. However, a variant of ECDH with a static scalar is used as a public key encryption scheme, for example in JSON Web Encryption. The attack can fully recover the private key in that scenario.</p>

<p class="description"></p>
<p>No bug is small enough.</p>
</div>
<div class="column left" id="details">
<h3>Info</h3>
<p>
<b>Day:</b>
<a href="/congress/2017/Fahrplan/schedule/1.html">2017-12-27</a>
<br>
<b>Start time:</b>
14:00
<br>
<b>Duration:</b>
01:00
<br>
<b>Room:</b>
Saal Dijkstra
<br>
<b>Track:</b>
<font class="event track-security">
<a href="/congress/2017/Fahrplan/events.html#security">Security</a>
</font>
<br>
<b>Language:</b>
en
</p>
<h3>Links:</h3>
<ul>
<li><a href="/congress/2017/Fahrplan/events/9021.ics">iCalendar</a></li>
</ul>
<h3>Files</h3>
<ul>
<li><a href="/congress/2017/Fahrplan/system/event_attachments/attachments/000/003/359/original/Paris256.pdf">Slide deck</a></li>
<li><a href="/congress/2017/Fahrplan/system/event_attachments/attachments/000/003/360/original/paris256.mp4">Demo</a></li>
</ul>
<h3>Feedback</h3>
<p>
<a href="https://frab.cccv.de/en/34c3/public/events/9021/feedback/new">Click here to let us know how you liked this event.</a>
</p>
<div class="column left" id="concurrent_events">
<h3><span class="translation_missing" title="translation missing: en.public.schedule.event.concurrent_events">Concurrent Events</span></h3>
<dl class="dl-horizontal">
</dl>
</div>
</div>
<div class="column right" id="sidebar">
<h3>Speakers</h3>
<table class="list">
<tbody>
<tr>
<td><div class="image small"><img src="/congress/2017/Fahrplan/system/people/avatars/000/006/145/small/filippo_valsorda_300.jpg" alt="Filippo valsorda 300"></div></td>
<td><a href="/congress/2017/Fahrplan/speakers/6145.html">Filippo Valsorda</a></td>
</tr>
</tbody>
</table>
</div>
<div class="span16">
</div>
<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Event",
  "name" : "Squeezing a key through a carry bit",
  "location" : {
    "@type" : "Place",
    "name" : "Saal Dijkstra",
    "address" : "34th Chaos Communication Congress"
  },
  "startDate" : "2017-12-27T14:00:00+0100",
  "endDate" : "2017-12-27T15:00:00+0100",
  "performer" : [{&quot;name&quot;:&quot;Filippo Valsorda&quot;,&quot;@type&quot;:&quot;Person&quot;,&quot;sameAs&quot;:&quot;/en/34c3/public/speakers/6145&quot;,&quot;image&quot;:&quot;/system/people/avatars/000/006/145/small/filippo_valsorda_300.jpg?1508045498&quot;}],
  "inLanguage" : "en",
  "superEvent" : {
    "@type" : "Event",
    "sameAs" : "/en/34c3/public/schedule",
    "name" : "34th Chaos Communication Congress",
    "location" : {
      "@type" : "Place",
      "name" : "34th Chaos Communication Congress",
      "address" : "34th Chaos Communication Congress"
    },
    "startDate" : "2017-12-27T10:00:00+0100"
  }
}

</script>

<br class="clear">
</div>
</div>
<div id="footer">
<p>This schedule was generated with <a href="http://frab.github.io/frab/">frab</a>.</p>
</div>
</body>
</html>
